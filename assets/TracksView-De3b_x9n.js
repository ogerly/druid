import{d as K,o as O,M as x,g as c,j as t,y as i,z as d,A as r,E as X,G as z,H as C,r as y,N as q,u,D as m,t as l,C as $,I as H}from"./index-DhICvMMZ.js";import{_ as Z}from"./_plugin-vue_export-helper-DlAUqK2U.js";const J={class:"p-4 max-w-6xl mx-auto"},Q={class:"flex justify-between items-center mb-6"},Y={key:0,class:"flex justify-center items-center py-12"},tt={key:1,class:"text-center py-12"},et={key:2,class:"space-y-4"},st={class:"card-body"},nt={class:"flex justify-between items-start mb-4"},ot={class:"card-title text-2xl"},at={class:"text-sm text-base-content/60 flex items-center gap-2 mt-1"},it={key:0,class:"badge badge-error badge-sm"},lt={key:1,class:"badge badge-warning badge-sm"},dt={class:"dropdown dropdown-end"},rt={tabindex:"0",class:"btn btn-ghost btn-circle btn-sm"},ct={tabindex:"0",class:"dropdown-content z-[1] menu p-2 shadow bg-base-100 rounded-box w-52"},ut=["onClick"],mt=["onClick"],pt=["onClick"],ht={class:"border-t mt-2 pt-2"},gt=["onClick"],vt={class:"stats stats-vertical sm:stats-horizontal shadow"},_t={class:"stat"},xt={class:"stat-figure text-primary"},yt={class:"stat-value text-primary text-lg sm:text-2xl"},bt={class:"stat-desc"},ft={class:"stat"},wt={class:"stat-figure text-secondary"},Tt={class:"stat-value text-secondary text-lg sm:text-2xl"},Dt={class:"stat-desc"},Mt={class:"stat"},kt={class:"stat-figure text-accent"},zt={class:"stat-value text-accent text-lg sm:text-2xl"},Ct={class:"stat-desc"},$t={key:0,class:"mt-4"},St={class:"overflow-x-auto max-h-64 overflow-y-auto"},Ft={class:"table table-zebra table-sm"},Lt={class:"font-mono text-xs"},jt={class:"card-actions justify-end mt-4"},Et=["onClick"],Nt=["onClick"],Pt=K({__name:"TracksView",setup(At){const S=H(),h=y([]),v=y(!0),p=y(null);O(async()=>{await g()});const g=async()=>{v.value=!0;try{h.value=await x.tracks.orderBy("startTime").reverse().toArray(),console.log("ðŸ“‹ Loaded tracks:",h.value.length)}catch(s){console.error("âŒ Failed to load tracks:",s)}finally{v.value=!1}},F=s=>{p.value=p.value===s?null:s},b=s=>{let e=0;for(let a=1;a<s.waypoints.length;a++){const n=s.waypoints[a-1],o=s.waypoints[a];if(!n||!o)continue;const _=6371e3,B=n.lat*Math.PI/180,U=o.lat*Math.PI/180,D=(o.lat-n.lat)*Math.PI/180,M=(o.lng-n.lng)*Math.PI/180,k=Math.sin(D/2)*Math.sin(D/2)+Math.cos(B)*Math.cos(U)*Math.sin(M/2)*Math.sin(M/2),I=2*Math.atan2(Math.sqrt(k),Math.sqrt(1-k));e+=_*I}return e},f=s=>s.endTime?s.endTime-s.startTime:Date.now()-s.startTime,L=s=>{const e=s.distance||b(s),a=s.duration||f(s);return e/(a/1e3)},j=s=>Math.max(...s.waypoints.map(e=>e.speed||0)),E=s=>new Date(s).toLocaleDateString("de-DE",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}),N=s=>new Date(s).toLocaleTimeString("de-DE",{hour:"2-digit",minute:"2-digit",second:"2-digit"}),P=s=>{const e=new Date(s.startTime).toLocaleTimeString("de-DE",{hour:"2-digit",minute:"2-digit"});if(s.endTime){const a=new Date(s.endTime).toLocaleTimeString("de-DE",{hour:"2-digit",minute:"2-digit"});return`${e} - ${a}`}return`seit ${e}`},A=s=>s<1e3?`${s.toFixed(0)} m`:`${(s/1e3).toFixed(2)} km`,G=s=>{const e=Math.floor(s/1e3),a=Math.floor(e/3600),n=Math.floor(e%3600/60);return a>0?`${a}:${n.toString().padStart(2,"0")} h`:`${n} min`},w=s=>`${(s*3.6).toFixed(1)} km/h`,T=s=>{console.log("View track on map:",s.id),S.push("/")},R=s=>{console.log("Export GPX:",s.name);const e=JSON.stringify(s,null,2),a=new Blob([e],{type:"application/json"}),n=URL.createObjectURL(a),o=document.createElement("a");o.href=n,o.download=`${s.name.replace(/\s+/g,"_")}_${s.id.slice(0,8)}.json`,o.click(),URL.revokeObjectURL(n)},V=async s=>{const e=prompt("Neuer Name:",s.name);if(e&&e!==s.name)try{await x.tracks.update(s.id,{name:e,updatedAt:Date.now()}),await g(),console.log("âœ… Track renamed:",e)}catch(a){console.error("âŒ Failed to rename track:",a)}},W=async s=>{if(confirm("Wanderung wirklich lÃ¶schen? Diese Aktion kann nicht rÃ¼ckgÃ¤ngig gemacht werden."))try{await x.tracks.delete(s),await g(),console.log("âœ… Track deleted:",s)}catch(e){console.error("âŒ Failed to delete track:",e)}};return(s,e)=>{const a=q("router-link");return u(),c("div",J,[t("div",Q,[e[0]||(e[0]=t("h1",{class:"text-3xl font-bold"},"Meine Wanderungen",-1)),t("button",{onClick:g,class:"btn btn-circle btn-ghost",title:"Aktualisieren"},[i(d(r),{type:"refresh-cw",size:"20"})])]),v.value?(u(),c("div",Y,[...e[1]||(e[1]=[t("span",{class:"loading loading-spinner loading-lg"},null,-1)])])):h.value.length===0?(u(),c("div",tt,[i(d(r),{type:"map",size:"64",class:"mx-auto mb-4 opacity-30"}),e[3]||(e[3]=t("h2",{class:"text-2xl font-bold mb-2"},"Noch keine Wanderungen",-1)),e[4]||(e[4]=t("p",{class:"text-base-content/60 mb-4"}," Starte dein erstes GPS-Tracking auf der Karte! ",-1)),i(a,{to:"/",class:"btn btn-primary"},{default:X(()=>[i(d(r),{type:"map",size:"20"}),e[2]||(e[2]=m(" Zur Karte ",-1))]),_:1})])):(u(),c("div",et,[(u(!0),c(z,null,C(h.value,n=>(u(),c("div",{key:n.id,class:"card bg-base-200 shadow-xl hover:shadow-2xl transition-shadow"},[t("div",st,[t("div",nt,[t("div",null,[t("h2",ot,l(n.name),1),t("div",at,[i(d(r),{type:"calendar",size:"14"}),m(" "+l(E(n.startTime))+" ",1),n.status==="recording"?(u(),c("span",it,[...e[5]||(e[5]=[t("span",{class:"animate-ping absolute inline-flex h-full w-full rounded-full bg-error opacity-75"},null,-1),m(" Aktiv ",-1)])])):n.status==="paused"?(u(),c("span",lt," Pausiert ")):$("",!0)])]),t("div",dt,[t("label",rt,[i(d(r),{type:"more-vertical",size:"20"})]),t("ul",ct,[t("li",null,[t("a",{onClick:o=>T(n)},[i(d(r),{type:"map",size:"16"}),e[6]||(e[6]=m("Auf Karte anzeigen",-1))],8,ut)]),t("li",null,[t("a",{onClick:o=>R(n)},[i(d(r),{type:"download",size:"16"}),e[7]||(e[7]=m("GPX Export",-1))],8,mt)]),t("li",null,[t("a",{onClick:o=>V(n)},[i(d(r),{type:"edit",size:"16"}),e[8]||(e[8]=m("Umbenennen",-1))],8,pt)]),t("li",ht,[t("a",{onClick:o=>W(n.id),class:"text-error"},[i(d(r),{type:"trash-2",size:"16"}),e[9]||(e[9]=m("LÃ¶schen ",-1))],8,gt)])])])]),t("div",vt,[t("div",_t,[t("div",xt,[i(d(r),{type:"navigation",size:"24"})]),e[10]||(e[10]=t("div",{class:"stat-title"},"Distanz",-1)),t("div",yt,l(A(n.distance||b(n))),1),t("div",bt,l(n.waypoints.length)+" Wegpunkte",1)]),t("div",ft,[t("div",wt,[i(d(r),{type:"clock",size:"24"})]),e[11]||(e[11]=t("div",{class:"stat-title"},"Dauer",-1)),t("div",Tt,l(G(n.duration||f(n))),1),t("div",Dt,l(P(n)),1)]),t("div",Mt,[t("div",kt,[i(d(r),{type:"zap",size:"24"})]),e[12]||(e[12]=t("div",{class:"stat-title"},"âˆ… Geschw.",-1)),t("div",zt,l(w(L(n))),1),t("div",Ct," Max: "+l(w(j(n))),1)])]),p.value===n.id?(u(),c("div",$t,[e[14]||(e[14]=t("div",{class:"divider"},"Wegpunkte",-1)),t("div",St,[t("table",Ft,[e[13]||(e[13]=t("thead",null,[t("tr",null,[t("th",null,"#"),t("th",null,"Zeit"),t("th",null,"Position"),t("th",null,"Genauigkeit"),t("th",null,"HÃ¶he")])],-1)),t("tbody",null,[(u(!0),c(z,null,C(n.waypoints,(o,_)=>(u(),c("tr",{key:o.id},[t("td",null,l(_+1),1),t("td",null,l(N(o.timestamp)),1),t("td",Lt,l(o.lat.toFixed(6))+", "+l(o.lng.toFixed(6)),1),t("td",null,l(o.accuracy.toFixed(1))+"m",1),t("td",null,l(o.altitude?o.altitude.toFixed(0)+"m":"-"),1)]))),128))])])])])):$("",!0),t("div",jt,[t("button",{onClick:o=>F(n.id),class:"btn btn-sm btn-ghost"},[i(d(r),{type:p.value===n.id?"chevron-up":"chevron-down",size:"16"},null,8,["type"]),m(" "+l(p.value===n.id?"Weniger":"Details"),1)],8,Et),t("button",{onClick:o=>T(n),class:"btn btn-sm btn-primary"},[i(d(r),{type:"map",size:"16"}),e[15]||(e[15]=m(" Auf Karte ",-1))],8,Nt)])])]))),128))]))])}}}),Vt=Z(Pt,[["__scopeId","data-v-9bc489d8"]]);export{Vt as default};
